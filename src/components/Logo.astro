---
import { siteConfig } from "../config/site";
import type { ComponentConfig } from "../utils/recipe-context";

interface Props {
  width?: number;
  height?: number;
  color?: string;
}

const { width = 140, height = 32, color = "currentColor" } = Astro.props;

// Check if we're in showcase mode (showcaseConfig is set by ShowcaseLayout)
const showcaseConfig = (Astro.locals as any).showcaseConfig as ComponentConfig | undefined;

// Use showcase config if available, otherwise fall back to siteConfig
const config = showcaseConfig || {
  name: siteConfig.name,
  nameAccent: (siteConfig as any).nameAccent || '',
  templateName: siteConfig.templateName,
  logo: siteConfig.logo,
  logoMark: (siteConfig as any).logoMark || 'icon-text',
};

const hasEmoji = config.logo.emoji && config.logo.emoji.trim() !== "";
const hasChar = 'char' in config.logo && (config.logo as any).char && (config.logo as any).char.trim() !== "";
const hasSvgIcon = 'svgIcon' in config.logo && (config.logo as any).svgIcon && (config.logo as any).svgIcon.trim() !== "";
const hasLogo = !hasEmoji && !hasChar && !hasSvgIcon && config.logo.src && config.logo.src.trim() !== "";
const showTemplateName = 'showTemplateName' in config ? config.showTemplateName !== false : true;
const hasTemplateName = showTemplateName && config.templateName && config.templateName.trim() !== "";
const nameAccent = config.nameAccent || '';
const logoMark = config.logoMark || 'icon-text';
const logoChar = hasChar ? (config.logo as any).char : config.name.charAt(0);
const svgIcon = hasSvgIcon ? (config.logo as any).svgIcon : '';
const isGradientBox = logoMark === 'gradient-box';
---

<div class="logo-container" style={`color: ${color};`}>
  {isGradientBox && (
    <span class="logo-icon">{logoChar}</span>
  )}
  {!isGradientBox && hasSvgIcon && (
    <span class="logo-svg" set:html={svgIcon} />
  )}
  {!isGradientBox && !hasSvgIcon && hasEmoji && (
    <span class="logo-emoji">{config.logo.emoji}</span>
  )}
  {!isGradientBox && !hasSvgIcon && hasLogo && (
    <img
      src={config.logo.src}
      alt={config.logo.alt}
      class="logo-mark"
      width={config.logo.width}
      height={config.logo.height}
      loading="eager"
    />
  )}
  <span class="logo-text">
    <span class="logo-name">{config.name}{nameAccent && <span class="logo-name-accent">{nameAccent}</span>}</span>
    {hasTemplateName && !nameAccent && <span class="logo-template">{config.templateName}</span>}
  </span>
</div>

<style>
  .logo-container {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .logo-emoji {
    font-size: 1.5rem;
    line-height: 1;
    flex-shrink: 0;
  }

  .logo-svg {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    color: var(--header-logo-color, var(--accent-primary));
  }

  .logo-svg :global(svg) {
    width: 32px;
    height: 32px;
  }

  /* Gradient box logo icon (startup/SaaS style) */
  .logo-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    background: var(--logo-icon-gradient, linear-gradient(135deg, var(--accent-primary, #a855f7), var(--accent-secondary, #6366f1)));
    border-radius: 8px;
    font-family: var(--header-logo-font, var(--font-serif));
    font-size: 1rem;
    font-weight: 600;
    color: #ffffff;
    flex-shrink: 0;
  }

  .logo-mark {
    display: block;
    flex-shrink: 0;
    flex-grow: 0;
    object-fit: contain;
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
  }

  .logo-text {
    display: flex;
    align-items: baseline;
    gap: 6px;
    flex-shrink: 0;
    white-space: nowrap;
  }

  .logo-name {
    font-family: var(--header-logo-font, var(--font-serif, var(--font-sans)));
    font-weight: var(--header-logo-weight, 400);
    font-size: var(--header-logo-size, 1.5rem);
    letter-spacing: var(--header-logo-letter-spacing, 0);
    color: var(--header-logo-color, var(--text-primary));
  }

  .logo-name-accent {
    color: var(--header-logo-accent-color, var(--accent-primary));
  }

  .logo-template {
    font-family: var(--header-logo-font, var(--font-sans));
    font-weight: 300;
    font-size: var(--header-logo-size, 1.25rem);
    letter-spacing: -0.3px;
    color: var(--header-logo-accent, var(--text-primary));
  }
</style>
